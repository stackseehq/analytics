---
title: Providers
description: Understanding the plugin architecture that powers event delivery
---

Providers are plugins that send your events to analytics services. The library uses a flexible plugin architecture that allows you to use any analytics service—or multiple services simultaneously.

## What Are Providers?

A provider is a small adapter that translates your events into the format expected by an analytics service:

```typescript
import { createClientAnalytics } from '@stacksee/analytics/client';
import { PostHogClientProvider } from '@stacksee/analytics/providers/client';

const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' })
  ]
});

// You call track()
analytics.track('user_signed_up', { email: 'user@example.com' });

// Provider handles the rest:
// 1. Transforms event to PostHog format
// 2. Sends to PostHog servers
// 3. Handles errors gracefully
```

## Why Use Providers?

### 1. **Switch Services Without Code Changes**

Your tracking code stays the same, just swap providers:

```typescript
// Week 1: Using PostHog
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' })
  ]
});

// Week 2: Switched to Pirsch - same tracking code!
const analytics = createClientAnalytics({
  providers: [
    new PirschClientProvider({ identificationCode: 'xxx' })
  ]
});

// Your components don't change at all
analytics.track('button_clicked', { id: 'cta' });
```

### 2. **Use Multiple Services**

Send events to multiple analytics services with one call:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' }),  // Product analytics
    new BentoClientProvider({ siteUuid: 'xxx' }),  // Email marketing
    new PirschClientProvider({ identificationCode: 'xxx' })  // Privacy-focused analytics
  ]
});

// All three services receive this event
analytics.track('user_signed_up', {
  email: 'user@example.com',
  plan: 'pro'
});
```

### 3. **Graceful Error Handling**

If one provider fails, others continue working:

```typescript
// PostHog is down, but Bento still receives events
analytics.track('purchase', { amount: 99.99 });
// ❌ PostHog fails silently
// ✅ Bento receives event
// ✅ Pirsch receives event
```

## Available Providers

<Cards>
  <Card title="PostHog" href="/docs/providers/posthog">
    Product analytics with feature flags and session replay
  </Card>
  <Card title="Bento" href="/docs/providers/bento">
    Email marketing and automation with event tracking
  </Card>
  <Card title="Pirsch" href="/docs/providers/pirsch">
    Privacy-focused, cookie-free web analytics
  </Card>
  <Card title="Proxy Provider" href="/docs/providers/proxy">
    Route events through your server to bypass ad-blockers
  </Card>
  <Card title="Custom Providers" href="/docs/providers/custom">
    Create your own provider for any analytics service
  </Card>
</Cards>

## Provider Lifecycle

All providers implement a standard interface:

```typescript
interface AnalyticsProvider {
  // Initialize the provider (load SDK, connect, etc.)
  initialize(): Promise<void> | void;

  // Track a custom event
  track(event: BaseEvent, context?: EventContext): Promise<void> | void;

  // Identify a user
  identify(userId: string, traits?: Record<string, unknown>): Promise<void> | void;

  // Track page view
  pageView(properties?: Record<string, unknown>, context?: EventContext): Promise<void> | void;

  // Track page leave
  pageLeave(properties?: Record<string, unknown>, context?: EventContext): Promise<void> | void;

  // Reset user session (logout)
  reset(): Promise<void> | void;

  // Cleanup (server-side only)
  shutdown?(): Promise<void>;
}
```

### Initialization

Providers are initialized automatically when you create an analytics instance:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' })
  ]
});

// PostHogClientProvider.initialize() is called automatically
await analytics.initialize();
```

You can also initialize manually if needed:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' })
  ]
});

// Initialize later
await analytics.initialize();
```

### Tracking Events

When you call `track()`, all providers receive the event:

```typescript
analytics.track('button_clicked', {
  buttonId: 'cta',
  location: 'hero'
});

// Behind the scenes:
// 1. Event is normalized
// 2. Each provider's track() method is called
// 3. Providers transform and send the event
// 4. Errors are caught and logged
```

### User Identification

The `identify()` method tells providers who the current user is:

```typescript
analytics.identify('user-123', {
  email: 'user@example.com',
  name: 'John Doe',
  plan: 'pro'
});

// All providers are notified:
// - PostHog creates/updates user profile
// - Bento adds user to email list
// - Pirsch associates future events with this user
```

### Shutdown (Server-Side)

Server providers must be shut down to flush pending events:

```typescript
import { serverAnalytics } from '@/lib/server-analytics';

// Track some events
await serverAnalytics.track('api_request', { endpoint: '/users' });

// IMPORTANT: Always shutdown in serverless environments
await serverAnalytics.shutdown();
```

Without `shutdown()`, events may be lost when the serverless function terminates.

## Using Multiple Providers

### Common Combinations

**Product Analytics + Email Marketing:**

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' }),  // Track behavior
    new BentoClientProvider({ siteUuid: 'xxx' })   // Send emails
  ]
});
```

**Privacy-Focused + Full-Featured:**

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PirschClientProvider({ identificationCode: 'xxx' }),  // GDPR-compliant
    new PostHogClientProvider({ token: 'xxx' })               // Full features
  ]
});
```

**Client-Side + Server-Side Proxy:**

```typescript
const analytics = createClientAnalytics({
  providers: [
    new ProxyClientProvider({
      endpoint: '/api/analytics'  // Bypass ad-blockers
    })
  ]
});
```

### Conditional Providers

Enable providers based on environment or user consent:

```typescript
const providers = [];

// Always use privacy-focused analytics
providers.push(new PirschClientProvider({ identificationCode: 'xxx' }));

// Only add PostHog if user consented
if (userConsent.analytics) {
  providers.push(new PostHogClientProvider({ token: 'xxx' }));
}

// Only use Bento in production
if (process.env.NODE_ENV === 'production') {
  providers.push(new BentoClientProvider({ siteUuid: 'xxx' }));
}

const analytics = createClientAnalytics({ providers });
```

## Environment-Specific Imports

Always import providers from the correct path to avoid bundling issues:

<Tabs items={['Client-Side', 'Server-Side']}>
<Tab value="Client-Side">

```typescript
// ✅ Correct - only browser code
import { createClientAnalytics } from '@stacksee/analytics/client';
import { PostHogClientProvider } from '@stacksee/analytics/providers/client';

// ❌ Wrong - may bundle Node.js code
import { PostHogClientProvider } from '@stacksee/analytics/providers';
```

</Tab>
<Tab value="Server-Side">

```typescript
// ✅ Correct - only Node.js code
import { createServerAnalytics } from '@stacksee/analytics/server';
import { PostHogServerProvider } from '@stacksee/analytics/providers/server';

// ❌ Wrong - may bundle browser code
import { PostHogServerProvider } from '@stacksee/analytics/providers';
```

</Tab>
</Tabs>

## Provider Configuration

### Common Options

Most providers support these options:

```typescript
new PostHogClientProvider({
  token: 'xxx',

  // Enable debug logging
  debug: process.env.NODE_ENV === 'development',

  // Disable the provider
  enabled: !!process.env.POSTHOG_TOKEN,

  // Custom API endpoint
  api_host: 'https://analytics.example.com'
})
```

### Provider-Specific Options

Each provider has its own configuration options. See the provider guides for details:

- [PostHog Configuration](/docs/providers/posthog)
- [Bento Configuration](/docs/providers/bento)
- [Pirsch Configuration](/docs/providers/pirsch)

## Error Handling

Providers handle errors gracefully:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({ token: 'xxx' }),
    new BentoClientProvider({ siteUuid: 'xxx' })
  ]
});

// If PostHog fails, Bento still receives the event
analytics.track('user_signed_up', { email: 'user@example.com' });
```

Enable debug mode to see errors:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({
      token: 'xxx',
      debug: true  // Logs errors to console
    })
  ],
  debug: true  // Logs all analytics activity
});
```

## Best Practices

### 1. Use Environment Variables

Never hardcode API keys:

```typescript
// ✅ Good
new PostHogClientProvider({
  token: import.meta.env.VITE_POSTHOG_KEY  // Vite
  // OR
  token: process.env.NEXT_PUBLIC_POSTHOG_KEY  // Next.js
})

// ❌ Bad
new PostHogClientProvider({
  token: 'phc_1234567890'  // Hardcoded!
})
```

### 2. Initialize Once

Create your analytics instance once and reuse it:

```typescript
// ✅ Good - lib/analytics.ts
export const analytics = createClientAnalytics({ /* ... */ });

// components/Button.tsx
import { analytics } from '@/lib/analytics';

// ❌ Bad - components/Button.tsx
function Button() {
  const analytics = createClientAnalytics({ /* ... */ }); // Recreated every render!
}
```

### 3. Graceful Degradation

Make providers optional:

```typescript
const providers = [];

if (process.env.VITE_POSTHOG_KEY) {
  providers.push(new PostHogClientProvider({
    token: process.env.VITE_POSTHOG_KEY
  }));
}

const analytics = createClientAnalytics({
  providers: providers.length > 0 ? providers : [new NoOpProvider()]
});
```

### 4. Test with Debug Mode

Enable debug mode during development:

```typescript
const analytics = createClientAnalytics({
  providers: [
    new PostHogClientProvider({
      token: 'xxx',
      debug: import.meta.env.DEV
    })
  ],
  debug: import.meta.env.DEV
});
```

## Next Steps

<Cards>
  <Card title="Provider Guides" href="/docs/providers">
    Setup guides for each analytics provider
  </Card>
  <Card title="Custom Providers" href="/docs/providers/custom">
    Create your own provider for any analytics service
  </Card>
  <Card title="Client vs Server" href="/docs/core-concepts/client-vs-server">
    Learn when to use client-side vs server-side tracking
  </Card>
</Cards>
